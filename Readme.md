# Typewriter recipes

This is part of the presentation how to generate automaticaly models and services from controllers and model classes in .net core web api for angular>11.x.x using [Typewriter Unofficial Fork](https://github.com/AdaskoTheBeAsT/Typewriter/releases/tag/1.30.0)

## Backend

Right now .net 5 and .net core 3.1 allows to create nice dry web api. In version 2.x I used Andrew Lock template named [NetEscapades.Templates](https://github.com/andrewlock/NetEscapades.Templates) described in blog post [Removing the MVC Razor dependencies from the Web API template in ASP.NET Core](https://andrewlock.net/removing-the-mvc-razor-dependencies-from-the-web-api-template-in-asp-net-core/).
In 2.x small modification was needed to serve static files.

```cs
    app.UseMvc();
    app.UseDefaultFiles(); //added
    app.UseStaticFiles(); //added
```

## Frontend
Angular v11.0
install node v14.15.4

Basic set of npm packages

```cmd
npm i -g typescript
npm i -g tslint
npm i -g webpack
npm i -g @angular/cli
npm i -g rxjs-tslint
```

For new project i use yarn as a package manager

```cmd
ng set --global packageManager=yarn
```

Frontend folder is created in main folder of webapi .
For styles scss is used. App is setup without inline templates and styles

```cmd
ng new ClientApp --strict
```

Angular way of testing was modified base on article
[Use React tools for better Angular apps](https://medium.com/@martin_hotell/use-react-tools-for-better-angular-apps-b0f14f3f8114)
For unit test karma/jasmine combo was replaced by Jest;
For e2e tests protractor was replaced by testcafe.

## Build script

Build is based on excelent [Cake](https://cakebuild.net/) project. script is located in cake folder and it is copmposed from two cake files:

1. build.cake - main file which is aggregator of steps
1. build.steps.cake - steps definitions
Right now script is able to run frontend and backend compilation. 
In future description how to setup sonaqube will be added.

## Tricks

### Frontend tricks

#### 'base' tag generated dynamically

Due to fact that application can be deployed as a web site or as a web application, debugged etc. base tag in angular app
can be set manually (and maintained which can be error prone). In sample base tag is autogenerated by following javascript.

```javascript
(function () {
    'use strict';
    var r = document.location.href;
    var i = r.indexOf('#');
    if (i > 0) {
        r = r.substring(0, i);
    } else if ((r.length > 1) && (r[r.length - 1] === '/') && (r[r.length - 2] === '/')) {
        r = r.substring(0, r.length - 2);
    }
    if (r[r.length - 1] !== '/') {
        r = r + '/';
    }
    document.write('<base href="' + r + '" />');
}());
```
